<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Notes on using Micro-Manager">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Micro-Manager | Kyle M. Douglass</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://kmdouglass.github.io/stories/notes/micro-manager.html">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
    }
});
</script><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><meta name="description" itemprop="description" content="Notes on using Micro-Manager">
<meta name="author" content="Kyle M. Douglass">
<meta property="og:site_name" content="Kyle M. Douglass">
<meta property="og:title" content="Micro-Manager">
<meta property="og:url" content="http://kmdouglass.github.io/stories/notes/micro-manager.html">
<meta property="og:description" content="Notes on using Micro-Manager">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-05-07T09:29:44+02:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://kmdouglass.github.io/">

                <span id="blog-title">Kyle M. Douglass</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../about-me.html">About</a>
                </li>
<li>
<a href="../../posts/index.html">Blog</a>
                </li>
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../notes-and-projects.html">Notes</a>
                </li>
<li>
<a href="../contact.html">Contact</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="micro-manager.org" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Micro-Manager</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="micro-manager.html#sec-1">MMCoreJ: The Micro-Manager Java wrapper</a>
<ul>
<li><a href="micro-manager.html#sec-1-1">Compiling against the MMCoreJ.jar library</a></li>
<li><a href="micro-manager.html#sec-1-2">Specifying the mmcorej.library.path</a></li>
<li><a href="micro-manager.html#sec-1-3">Testing the Java environment</a></li>
</ul>
</li>
<li>
<a href="micro-manager.html#sec-2">Matlab control of Micro-Manager</a>
<ul>
<li>
<a href="micro-manager.html#sec-2-1">Accessing MMCore Java wrappers in Matlab</a>
<ul>
<li><a href="micro-manager.html#sec-2-1-1">Location of the .jar files</a></li>
<li><a href="micro-manager.html#sec-2-1-2">Test that Matlab can access the MM .jar files</a></li>
<li><a href="micro-manager.html#sec-2-1-3">Don't use ~ to reference the home directory</a></li>
</ul>
</li>
<li><a href="micro-manager.html#sec-2-2">Opening a Micro-Manager tagged image</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">MMCoreJ: The Micro-Manager Java wrapper</h2>
<div class="outline-text-2" id="text-1">
<p>
Most of the support one finds for Micro-Manager is for the Java
wrapper around the MMCore class (which is written in C++). Because
of this, it is useful to try to understand how Micro-Manager works
in Java, rather than in Python or C++. Once a particular aspect of
MM is understood in Java, I have found that it is easier to use it
in another language.
</p>

<hr>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Compiling against the MMCoreJ.jar library</h3>
<div class="outline-text-3" id="text-1-1">
<p>
For some unknown reason, specifying the location of MMCoreJ.jar in
bash's CLASSPATH environment variable just does not work for me. To
ensure that a Java program can find the Java wrappers, I pass the
full directory and name of the MMCoreJ.jar file to the compiler
with the <code>-cp</code> flag:
</p>

<div class="highlight"><pre><span></span>javac -cp &lt;span <span class="nv">style</span><span class="o">=</span><span class="s2">"font-style: italic;"</span>&gt;<span class="s2">"/home/kmdouglass/mm/micro-manager1.4/MMCoreJ_wrap/MMCoreJ.jar"</span>&lt;/span&gt; TestMM.java
</pre></div>

<p>
(Note that TestMM.java is the file containing the code that I wish
to compile.) Doing this successfully allows Java to find the
libraries in the .jar when the <code>import mmcorej.CMMCore;</code> line is
encountered.
</p>

<hr>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Specifying the mmcorej.library.path</h3>
<div class="outline-text-3" id="text-1-2">
<p>
In my opinion, the <a href="https://www.micro-manager.org/wiki/Search_Paths#MMCoreJ_wrap_Search_Paths">MM documentation on search paths</a> is not very
clear. Much of the confusion comes from the fact that the proper
library required by the JVM linker is named and located differently
on Windows, Linux, and Mac. To get around this, the documentation
uses <b>MMCoreJ_wrap</b> to refer to this library independently of the
system, which is unfortunate since there is also a folder named
MMCoreJ_wrap. 
</p>

<p>
Once a .java file has been compiled with the appropriate classpath
flag described above, executing the java class file needs both a
classpath and information on where the generic MMCoreJ_wrap library
is located.
</p>

<p>
First, on Linux, the MMCoreJ_wrap library is actually inside a
hidden directory. (This fact alone caused me a good deal of
grief). On my system it's in <code>(MM SOURCE
   DIR)/micro-manager1.4/MMCoreJ_wrap/.libs</code>, where <code>(MM SOURCE DIR)</code>
is the location of the MM source files. The appropriate library in
this folder seems to be <b>libMMCoreJ_wrap.so</b>. In Windows, I think
you will need a .dll file instead.
</p>

<p>
I specify the location of this library to the JVM using the
<code>-Dmmcorej.library.path</code> flag. Finally, note that I have to include
the current directory containing the .class file <i>in addition</i> to
the directory of the MMCoreJ.jar file. (This is what the <code>.:</code> is
doing in the argument of the <code>-cp</code> flag below.) The full command
line argument to run a class file named TestMM.class that utilizes
mmcorej.CMMCore is
</p>

<div class="highlight"><pre><span></span>java -cp &lt;span <span class="nv">style</span><span class="o">=</span><span class="s2">"font-style: italic;"</span>&gt;<span class="s2">".:/home/kmdouglass/mm/micro-manager1.4/MMCoreJ_wrap/MMCoreJ.jar"</span>&lt;/span&gt; -Dmmcorej.library.path<span class="o">=</span>/home/kmdouglass/mm/micro-manager1.4/MMCoreJ_wrap/.libs TestMM
</pre></div>

<p>
Say that three times fast.
</p>
<hr>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">Testing the Java environment</h3>
<div class="outline-text-3" id="text-1-3">
<p>
I can test that I have specified the classpath and library path
correctly by compiling and running the following simple Java
program that creates a CMMCore instance and prints the version to
the terminal window.
</p>

<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold;"</span><span class="o">&gt;</span><span class="n">import</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold; text-decoration: underline;"</span><span class="o">&gt;</span><span class="n">mmcorej</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;.&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold; text-decoration: underline;"</span><span class="o">&gt;</span><span class="n">CMMCore</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;;</span>

<span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold;"</span><span class="o">&gt;</span><span class="kd">public</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold;"</span><span class="o">&gt;</span><span class="n">class</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold; text-decoration: underline;"</span><span class="o">&gt;</span><span class="n">TestMM</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold;"</span><span class="o">&gt;</span><span class="kd">public</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold;"</span><span class="o">&gt;</span><span class="kd">static</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold; text-decoration: underline;"</span><span class="o">&gt;</span><span class="kt">void</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold;"</span><span class="o">&gt;</span><span class="n">main</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;(&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold; text-decoration: underline;"</span><span class="o">&gt;</span><span class="n">String</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;[]</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold; font-style: italic;"</span><span class="o">&gt;</span><span class="n">args</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;)</span> <span class="o">{</span>

        <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold; text-decoration: underline;"</span><span class="o">&gt;</span><span class="n">CMMCore</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold; font-style: italic;"</span><span class="o">&gt;</span><span class="n">core</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold;"</span><span class="o">&gt;</span><span class="k">new</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold; text-decoration: underline;"</span><span class="o">&gt;</span><span class="n">CMMCore</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;();</span>
        <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold; text-decoration: underline;"</span><span class="o">&gt;</span><span class="n">String</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="s">"font-weight: bold; font-style: italic;"</span><span class="o">&gt;</span><span class="n">info</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="na">getVersionInfo</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">info</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<hr>
</div>
</div>
</div>


<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Matlab control of Micro-Manager</h2>
<div class="outline-text-2" id="text-2">
<hr>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Accessing MMCore Java wrappers in Matlab</h3>
<div class="outline-text-3" id="text-2-1">
<p>
I want to access the Java wrappers to easily read image file stack
metadata in Matlab. Unfortunately, it appears like the Micro-Manager
documentation on this is not too clear. The documentation I am
currently looking at on May 7, 2015 is here:
<a href="https://www.micro-manager.org/wiki/Micro-Manager_File_Formats">https://www.micro-manager.org/wiki/Micro-Manager_File_Formats</a>
</p>

<hr>
</div>

<div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1">Location of the .jar files</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
I used the Matlab script for identifying all the .jar files in the
MM directory that is mentioned <a href="https://micro-manager.org/wiki/Matlab_Configuration">at this link</a> and included below:
</p>

<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span>"<span class="o">&gt;</span><span class="k">function</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="p">[]</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="p">=</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span>"<span class="o">&gt;</span><span class="n">MMsetup_javaclasspath</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="n">path2MM</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">fileList</span> <span class="p">=</span> <span class="n">getAllFiles</span><span class="p">(</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="n">path2MM</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">);</span>
<span class="n">fileListJarBool</span> <span class="p">=</span> <span class="n">regexp</span><span class="p">(</span><span class="n">fileList</span><span class="p">,</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="s">'.jar$'</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="s">'end'</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">);</span>
<span class="n">fileListJarBool</span> <span class="p">=</span> <span class="n">cellfun</span><span class="p">(@</span><span class="nb">isempty</span><span class="p">,</span><span class="n">fileListJarBool</span><span class="p">);</span>
<span class="n">fileListJar</span> <span class="p">=</span> <span class="n">fileList</span><span class="p">(</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">text</span><span class="o">-</span><span class="n">decoration</span><span class="p">:</span> <span class="n">underline</span><span class="p">;</span>"<span class="o">&gt;~&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="n">fileListJarBool</span><span class="p">);</span>
<span class="n">fid</span> <span class="p">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">fullfile</span><span class="p">(</span><span class="n">prefdir</span><span class="p">,</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="s">'MMjavaclasspath.txt'</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">),</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="s">'w'</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">);</span>
<span class="n">fprintf</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="s">'&lt;before&gt;\r\n'</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">);</span>
<span class="n">cellfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span> <span class="n">fprintf</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="s">'%s\r\n'</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="n">fileListJar</span><span class="p">);</span>
<span class="n">fclose</span><span class="p">(</span><span class="n">fid</span><span class="p">);</span>
<span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span> <span class="n">text</span><span class="o">-</span><span class="n">decoration</span><span class="p">:</span> <span class="n">overline</span><span class="p">;</span>"<span class="o">&gt;</span><span class="c">%% nested directory listing ala gnovice from stackoverflow&lt;/span&gt;</span>
<span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="c">% inputs and outputs are self-explanatory&lt;/span&gt;</span>
<span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span>"<span class="o">&gt;</span><span class="k">function</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="n">fileList</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="p">=</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span>"<span class="o">&gt;</span><span class="n">getAllFiles</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="n">dirName</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">dirData</span> <span class="p">=</span> <span class="n">dir</span><span class="p">(</span><span class="n">dirName</span><span class="p">);</span>      <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="c">% Get the data for the current directory&lt;/span&gt;</span>
<span class="n">dirIndex</span> <span class="p">=</span> <span class="p">[</span><span class="n">dirData</span><span class="p">.</span><span class="n">isdir</span><span class="p">];</span>  <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="c">% Find the index for directories&lt;/span&gt;</span>
<span class="n">fileList</span> <span class="p">=</span> <span class="p">{</span><span class="n">dirData</span><span class="p">(</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">text</span><span class="o">-</span><span class="n">decoration</span><span class="p">:</span> <span class="n">underline</span><span class="p">;</span>"<span class="o">&gt;~&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="n">dirIndex</span><span class="p">).</span><span class="n">name</span><span class="p">}</span><span class="s">';  &lt;span style="font-weight: bold; font-style: italic;"&gt;% Get a list of the files&lt;/span&gt;</span>
<span class="s">&lt;span style="font-weight: bold;"&gt;if&lt;/span&gt; &lt;span style="font-weight: bold; text-decoration: underline;"&gt;~&lt;/span&gt;isempty(fileList)</span>
<span class="s">    fileList = cellfun(@(x) fullfile(dirName,x),fileList,&lt;span style="font-style: italic;"&gt;'</span><span class="n">UniformOutput</span><span class="o">'&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">,</span><span class="n">false</span><span class="p">);</span>
<span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span>"<span class="o">&gt;</span><span class="k">end</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
<span class="n">subDirs</span> <span class="p">=</span> <span class="p">{</span><span class="n">dirData</span><span class="p">(</span><span class="n">dirIndex</span><span class="p">).</span><span class="n">name</span><span class="p">};</span>  <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="c">% Get a list of the subdirectories&lt;/span&gt;</span>
<span class="n">validIndex</span> <span class="p">=</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">text</span><span class="o">-</span><span class="n">decoration</span><span class="p">:</span> <span class="n">underline</span><span class="p">;</span>"<span class="o">&gt;~&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="n">ismember</span><span class="p">(</span><span class="n">subDirs</span><span class="p">,{</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="s">'.'</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="s">'..'</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">});</span>  <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="c">% Find index of subdirectories&lt;/span&gt;</span>
<span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="c">%   that are not '.' or '..'&lt;/span&gt;</span>
<span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span>"<span class="o">&gt;</span><span class="k">for</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="n">iDir</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="p">=</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">text</span><span class="o">-</span><span class="n">decoration</span><span class="p">:</span> <span class="n">underline</span><span class="p">;</span>"<span class="o">&gt;</span><span class="nb">find</span><span class="p">(</span><span class="n">validIndex</span><span class="p">)</span>                  <span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="c">% Loop over valid subdirectories&lt;/span&gt;</span>
    <span class="n">nextDir</span> <span class="p">=</span> <span class="n">fullfile</span><span class="p">(</span><span class="n">dirName</span><span class="p">,</span><span class="n">subDirs</span><span class="p">{</span><span class="n">iDir</span><span class="p">});</span>    <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="c">% Get the subdirectory path&lt;/span&gt;</span>
    <span class="n">fileList</span> <span class="p">=</span> <span class="n">vertcat</span><span class="p">(</span><span class="n">fileList</span><span class="p">,</span> <span class="n">getAllFiles</span><span class="p">(</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="n">nextDir</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">));</span>  <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="c">% Recursively call getAllFiles&lt;/span&gt;</span>
<span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span>"<span class="o">&gt;</span><span class="k">end</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
</pre></div>

<p>
This .m file should be run as a function whose argument is a string of
the Micro-Manager install directory. <b>On my Debian Linux system, the
install directory is <i>usr/local/ImageJ/plugins/Micro-Manager</i></b>, NOT
the directory containing the source code. The function will create a
.txt file in Matlab's <i>prefdir</i> directory (which is ~/.matlab/R2014a/
on my system) called <i>MMjavaclasspath.txt</i>. I copied all the lines
except for the first one, which was the word `before' in angle
brackets, into the file <i>javaclasspath.txt</i>. I also inserted
<code>/usr/local/ImageJ/ij.jar</code> into this file as the first line.
</p>

<p>
Next, I restarted Matlab since it <a href="http://www.mathworks.com/help/matlab/matlab_external/bringing-java-classes-and-methods-into-matlab-workspace.html">requires a restart to access .jar
files added to the static class path</a>.
</p>

<hr>
</div>
</div>

<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2">Test that Matlab can access the MM .jar files</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
Once the static class path has been updated and Matlab restarted,
test that Matlab can see the .jar files using this code:
</p>

<div class="highlight"><pre><span></span><span class="n">import</span> <span class="n">mmcorej</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="n">bold</span><span class="p">;</span> <span class="n">text</span><span class="o">-</span><span class="n">decoration</span><span class="p">:</span> <span class="n">underline</span><span class="p">;</span>"<span class="o">&gt;.*&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
<span class="n">mmc</span> <span class="p">=</span> <span class="n">CMMCore</span><span class="p">;</span>
<span class="n">mmc</span><span class="p">.</span><span class="n">loadSystemConfiguration</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="s">'/usr/local/ImageJ/MMConfig_Demo.cfg'</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">);</span>
</pre></div>

<p>
Note that you may need to download MMConfig_Demo.cfg from
<a href="https://micro-manager.org/wiki/File:MMConfig_Demo.cfg">https://micro-manager.org/wiki/File:MMConfig_Demo.cfg</a>.
</p>

<hr>
</div>
</div>

<div id="outline-container-sec-2-1-3" class="outline-4">
<h4 id="sec-2-1-3">Don't use ~ to reference the home directory</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
I discovered after a while that directories in javaclasspath.txt
won't work if you use the tilde (~) to reference your home
directory. Use the full path instead in directory names instead.
</p>

<hr>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Opening a Micro-Manager tagged image</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Micro-Manager inserts two kinds of metadata into the images it
saves; one follows the <a href="https://www.openmicroscopy.org/site/support/ome-model/ome-tiff/">OME-TIFF</a> specification and the other
includes metadata about the aquisition. I often want the
Micro-Manager specific metadata, which is saved in JSON format.
</p>

<p>
Since there are already Micro-Manager Java classes that facilitate
reading this information, I will use these within Matlab to read
the metadata.
</p>

<p>
First, ensure that Matlab's <i>javaclasspath</i> can find the
Micro-Manager and ImageJ jar files as detailed above. Once this is
done, you can easily create instances of classes defined in the jar
files with Matlab's javaObjectEDT() command. The key here is to
ensure that you pass Java datatypes as arguments into class
constructors. For translating between Matlab and Java datatypes,
see the documentation here:
<a href="http://www.mathworks.com/help/matlab/matlab_external/passing-data-to-a-java-method.html">http://www.mathworks.com/help/matlab/matlab_external/passing-data-to-a-java-method.html</a>.
</p>

<p>
To open an image stack, you will need to create a class instance of
org.micromanager.acquisition.TaggedImageStorageMultipageTiff. If
the image stacks are located in a directory called <i>data_dir</i>, we
would type:
</p>

<div class="highlight"><pre><span></span><span class="n">img</span> <span class="p">=</span> <span class="n">javaObjectEDT</span><span class="p">(</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="s">'org.micromanager.acquisition.TaggedImageStorageMultipageTiff'</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="p">=</span>"<span class="n">font</span><span class="o">-</span><span class="n">style</span><span class="p">:</span> <span class="n">italic</span><span class="p">;</span>"<span class="o">&gt;</span><span class="s">'data_dir/'</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="p">[],</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">)</span>
</pre></div>

<p>
Note that Matlab's empty array <code>[]</code> is the same as a NULL return in
Java.
</p>
</div>
</div>
</div>
    </div>
    

</article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2016         <a href="mailto:kyle.douglass@epfl.ch">Kyle M. Douglass</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
